<!DOCTYPE html>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>    
<meta charset="UTF-8">
<title>时空互钻</title>

<link href="common.css" rel="stylesheet">

<script src="../../../tools/tssJS/tssJS.all.js"></script>
<script src="common.js"></script>
<script src="../../../tools/echarts/echarts-all-2.1.10.js"></script>

<script type="text/javascript">

var autoSize, title;

function showGlobal() {
	var globalValiable = window.parent.globalValiable;
	if(globalValiable && globalValiable.data) {
		title = globalValiable.title;
		show(globalValiable.data);
		return true;
	}
	return false;
}

window.onresize = showGlobal;

window.onload = function() {
	initResearhBt();

	if(showGlobal()) return;

	title = "报表XXX";
	$.ajax({
		url : "data/2.json",
		method : "GET",
		type : "json",
		waiting : true,
		ondata : function() {
			var data = this.getResponseJSON();
			show(data);
		}
	});	  
}

function show(data) {	
 	autoAdjustSize("canvasDiv");

	 // console.log(data.groupby("org,center", "weight"));

	var dayData = data.groupby("day", "weight");
	dayData.each(function(i, item){
		item.name = item.day;
		item.value = item.weight;
	});

	echartLine2D("canvasDiv", "XXX", dayData, "吨");
}



// data中数据个数和labels个数不一定相等，以labels为准，labels有data里没有的默认等于0
function echartLine2D(canvasName, title, data, unitName) {
	// 单条折线图
	if(isArray(data)) {
		var _data = {};
		_data[title] = data;
		data = _data;
	}

	var legends = [],
		series = [],
		labels = [];
 
	for(var legend in data) {
		legends.push(legend);
		var legendData = data[legend];
 
		var serieData = [];
		var temp = {};
		for(var i = 0; i < legendData.length; i++) {
			var item = legendData[i];
			temp[item.name] = item.value;
			labels.push(item.name);
		}

		for(var i = 0; i < labels.length; i++) {
			serieData[i] = temp[labels[i]] || 0;
		}

		series.push({
			"name": legend,
			"type": 'line',
			"data": serieData,
			smooth: true,
            //symbol: 'none', 
            symbolSize: 10,
            markPoint: {
                data: [
                    {type : 'max', name: '最大值'},
                    {type : 'min', name: '最小值'}
                ]
            },
            markLine: {
                data: [
                    {type : 'average', name: '平均值'}
                ]
            }

		});
	}	
	
	var chartObj = echarts.init($1(canvasName));
	var option = {
	    title : {
	        text: title
	    },
	    tooltip : {
	        trigger: 'axis'
	    },
	    legend: {
	        data:legends
	    },
	    toolbox: {
	        show : true,
	        feature : {
	            magicType : {show: true, type: ['line', 'bar']},
	            restore : {show: true},
	            saveAsImage : {show: true}
	        }
	    },
	    calculable : true,
	    xAxis : [
	        {
	            type : 'category',
	            boundaryGap : false,
	            data : labels
	        }
	    ],
	    yAxis : [
	        {
	            type : 'value',
	            axisLabel : {
	                formatter: '{value} ' + (unitName ? unitName : '')
	            }
	        }
	    ],
	    series : series
	};  

	chartObj.on('click', function (param) {
           console.log(param);
        });

	chartObj.setOption(option);                  
}

function echartPie2D(canvasName, title, data) {
	var labels = [];
	for(var i = 0; i < data.length; i++) {
		var item = data[i];
		labels[i] = item.name;
	}

	var chartObj = echarts.init($$(canvasName));
	var option = {
	    title : {
	        text: title,
	        x:'center'
	    },
	    tooltip : {
	        trigger: 'item',
	        formatter: "{a} <br/>{b} : {c} ({d}%)"
	    },
	    legend: {
	        orient : 'vertical',
	        x : 'left',
	        data: labels
	    },
	    toolbox: {
	        show : true,
	        feature : {
	            mark : {show: true},
	            dataView : {show: true, readOnly: false},
	            restore : {show: true},
	            saveAsImage : {show: true}
	        }
	    },
	    calculable : true,
	    series : [
	        {
	            name: title,
	            type:'pie',
	            radius : '75%',
	            center: ['50%', '50%'],
	            data:data
	        }
	    ]
	};
    chartObj.setOption(option);         
}

</script>
</head>

<body>

	<div id='canvasDiv'></div>
	<input type='button' id='researh' value='查询条件'/>

</body>
</html>