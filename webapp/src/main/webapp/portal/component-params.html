<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML xmlns:XForm>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>组件参数</title>

<link href="../framework/css/css.css" rel="stylesheet" type="text/css"></link>
<link href="../framework/balloon/balloon.css" rel="stylesheet" type="text/css"></link>
<link href="../framework/xform/xform.css" rel="stylesheet" type="text/css"></link>

<script language="javascript" src="../framework/core.js"></script>
<script language="javascript" src="../framework/ajax.js"></script>
<script language="javascript" src="../framework/framework.js"></script>
<script language="javascript" src="../framework/balloon/balloon.js"></script>
<script language="javascript" src="../framework/xform/xform.js"></script>

<script language="javascript" src="structure.js"></script>

<SCRIPT LANGUAGE="JavaScript">
<!--
    /*
     *	后台响应数据节点名称
     */
    XML_CONFIG_PARAMS = "ConfigParams";

    /*
     *	默认唯一编号名前缀
     */
    CACHE_CONFIG_PARAMS = "config__id";

    function init(){
        var url = "#";
		var params = window.dialogArguments.params;
        if( params && params.firstChild){
            url = params.firstChild.nodeValue;
        }

        var p = new HttpRequestParams();
        p.url = url;

        var request = new HttpRequest(p);
        request.onresult = function(){
            var configParamsNode = this.getNodeValue(XML_CONFIG_PARAMS);

            preProcessXml(configParamsNode, params);

            Cache.XmlIslands.add(CACHE_CONFIG_PARAMS, configParamsNode);

            $X("configParamsForm", configParamsNode);
        }
        request.send();    
    }
 
    function preProcessXml(xmlIsland, params){
        var dataNode = xmlIsland.selectSingleNode(".//data");
        var xmlReader = new XmlReader("<row/>");
        var rowNode = new XmlNode(xmlReader.documentElement);
        var attributes = params.attributes;
        for(var i=0; i < attributes.length; i++){
           rowNode.setCDATA(attributes[i].nodeName, attributes[i].nodeValue);
        }
        dataNode.appendChild(rowNode);
    }
 
    function getParams(){
        var xmlIsland = Cache.XmlIslands.get(CACHE_CONFIG_PARAMS);
        if(xmlIsland){
            var row = xmlIsland.selectSingleNode(".//data/row");            
            window.returnValue = row.toXml();
        }
        window.close();
    }

    window.onload = init;

//-->
</SCRIPT>

</head>

<body>
<div class="mainBox" id="mainBox">
  <table class="full" border="0" cellspacing="0" cellpadding="0">
    <tr valign="top">
      <td class="b">
	    <XForm:Box id="configParamsForm" baseurl="../framework/xform/"><div class="loading"></div></XForm:Box>
      </td>
    </tr>
    <tr height="30">
      <td align="right">
        <input type="button" value="关闭" class="btWeak" onclick="window.close()"/> 
		<input type="button" value="确定" class="btStrong" onclick="getParams()"/>
      </td>
    </tr>
  </table>
</div>
</body>
</html>