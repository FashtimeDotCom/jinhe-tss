<HTML xmlns:Grid>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>它山石--test Grid</title>

<link href="grid.css" rel="stylesheet" type="text/css">
<link href="../balloon/balloon.css" rel="stylesheet" type="text/css">
<link href="../menu/menu.css" rel="stylesheet" type="text/css">
<link href="../css/css.css" rel="stylesheet" type="text/css">

<script language="javascript" src="../core.js"></script>
<script language="javascript" src="../ajax.js"></script>
<script language="javascript" src="../framework.js"></script>
<script language="javascript" src="../balloon/balloon.js"></script>
<script language="javascript" src="../menu/menu.js"></script>

<script language="javascript" src="grid.js"></script>

<SCRIPT LANGUAGE="JavaScript">
<!--
 
URL_CORE = "../";
ICON = "../images/";

    function init() {

		// Element.attachColResize($$("ttt"));

		initGridMenu();

		Ajax({
			url : "test/data.xml",
			onresult : function() {
				var gridData = this.getNodeValue("SourceList");
				var grid = $G("grid", gridData);       

				var gridPage = this.getNodeValue("PageInfo");
				createGridToolBar(gridPage);			

				$$("grid").onScrollToBottom = function () {
					grid.load(gridData, true);
				}
				$$("grid").onRightClickRow = function () {
					grid.element.contextmenu.show(event.clientX, event.clientY);						
				}
				$$("grid").onDblClickRow = function () {
					alert($G("grid").getRowAttributeValue("id"));				
				}
			},
			onexception : function() {
				alert("exception");
			}
		});
    }

    function createGridToolBar(gridPage) {
        var toolbarObj = $$("gridToolBar");
			initGridToolBar(toolbarObj, gridPage, function(page) {
				Ajax({
					url : "test/data.xml",
					onresult : function() {
						var gridData = this.getNodeValue("SourceList");
						var grid = $G("grid", gridData);       

						var gridPage = this.getNodeValue("PageInfo");
						createGridToolBar(gridPage);
					}
				});
			});
    }

	function initGridMenu() { 
        var item1 = {
            label:"新增",
            callback:insertUser
        }
		var item2 = {
            label:"修改",
            callback:updateUser,
            icon:ICON + "edit.gif"
        }
		var item3 = {
            label:"删除",
            callback:deleteUser,
            icon:ICON + "icon_del.gif"
        }
		var item4 = {
            label:"获取ID列值",
            callback:getColumnValues
        }

        var menu1 = new Menu();
        menu1.addItem(item1);
		menu1.addItem(item2);
		menu1.addItem(item3);
		menu1.addItem(item4);
 
        $$("grid").contextmenu = menu1;
    }

	function insertUser() {
		var map = {"loginName":"潜龙勿用", "telephone":"8888888888", "set":"1"};
		$G("grid").insertRow(map);
	}

	function updateUser() {
		$G("grid").modifySelectedRow("loginName", "天地玄黄");
	}

	function deleteUser() {
		$G("grid").deleteSelectedRow();
	}

	function getColumnValues() {
		alert($G("grid").getColumnValues("id").join("|"));
	}
	
 
	window.onload = init;
   
//-->
</SCRIPT>
</head>

<body>

<table id="ttt" class="full" style="height:430px;width:900px;">
  <tr>
	<td id="gridTitle">
	  <span class="icon"></span>用户列表<span class="buttonBox" id="gridToolBar"></span>
	</td>
  </tr>
  <tr>
	<td>
		<Grid:Box id="grid" baseurl="" height="410" width="900" ></Grid:Box>
	</td>
  </tr>
</table>
										
 
</body>
</html>