<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML xmlns:Tree xmlns:Grid xmlns:XForm xmlns:WorkSpace>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>用户组织选择</title>

<link href="../framework/css/css.css" rel="stylesheet" type="text/css"></link>
<link href="../framework/tree/tree.css" rel="stylesheet" type="text/css"></link>


<script language="javascript" src="../framework/core.js"></script>
<script language="javascript" src="../framework/ajax.js"></script>
<script language="javascript" src="../framework/framework.js"></script>
<script language="javascript" src="../framework/tree/tree.js"></script>

 
 <SCRIPT type="text/javascript">
 <!--
	/*
     *	后台响应数据节点名称
     */
    XML_MAIN_TREE = "GroupTree";
    /*
     *	默认唯一编号名前缀
     */
    CACHE_MAIN_TREE = "tree__id";

    /*
     *	XMLHTTP请求地址汇总
     */
	URL_INIT = "data/group_tree.xml";

    URL_INIT = "/" + AUTH_PATH + "message/receivers/groups";  // "ums/message!getGroupTree.action";

    /*
     *	函数说明：页面初始化
     *	参数：	
     *	返回值：
     */
    function init(){
		var p = new HttpRequestParams();
		p.url = URL_INIT;

		var request = new HttpRequest(p);
		request.onresult = function(){
			var groupTreeNode = this.getNodeValue(XML_MAIN_TREE);

			var groupTreeNodeID = CACHE_MAIN_TREE;

			Cache.XmlIslands.add(groupTreeNodeID,groupTreeNode);

			initTree(groupTreeNodeID);
		}
		request.send();
    }

    function initTree(cacheID){
        var treeObj = $("tree");
        Public.initHTC(treeObj,"isLoaded","oncomponentready",function(){
            initTreeData(cacheID);
        });
    }

    function initTreeData(cacheID){
        var xmlIsland = Cache.XmlIslands.get(cacheID);
        if(null!=xmlIsland){
            var treeObj = $("tree");
            treeObj.load(xmlIsland.node);

            treeObj.onTreeNodeActived = function(eventObj){
				onTreeNodeActived(eventObj);
            }
            treeObj.onTreeNodeDoubleClick = function(eventObj){
                onTreeNodeDoubleClick(eventObj);
            }
        }    
    }

    function onTreeNodeDoubleClick(eventObj){
        getGroup();
    }

    function getGroup(){        
        var treeObj = $("tree");
        var activeTreeNode = treeObj.getActiveTreeNode();
        if(null!=activeTreeNode){
            var id = activeTreeNode.getId();
            var name = activeTreeNode.getName();
            var type = activeTreeNode.getAttribute("groupType");
            var appId = "";
            if(null==type || ""==type){
                id = "-4";
                appId = activeTreeNode.getId();
            }
            window.returnValue = {id:id,name:name,type:type,appId:appId};
            window.close();
        }
    }

    window.onload = init;

 //-->
 </SCRIPT>
</head>

<body>
<div class="mainBox" id="mainBox">
  <table class="full" border="0" cellspacing="0" cellpadding="0">
    <tr>
      <td>
        <Tree:TreeBox id="tree" treeType="menu" baseurl="../core/htc/tree/"><div class="loading"></div></Tree:TreeBox>
      </td>
    </tr>
    <tr>
      <td class="t" height="30" align="right">
        <input type="button" value="关闭" class="btWeak" onclick="window.close()"/> 
		<input type="button" value="确定" class="btStrong" onclick="getGroup()"/>
      </td>
    </tr>
  </table>
</div>
</body>
</html>
